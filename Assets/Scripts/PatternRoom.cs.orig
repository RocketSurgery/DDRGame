using UnityEngine;
using System.Collections;

[RequireComponent (typeof(Pattern))]
public class PatternRoom : MonoBehaviour 
{
	[SerializeField] GameObject pickupObj;
	[SerializeField] Color drawColor = Color.white;
	[SerializeField] bool drawGrid = false;
	
	void Awake()
	{
		transform.position = new Vector3((int)transform.position.x, (int)transform.position.y, transform.position.z);
		Setup(GetComponent<Pattern>());
	}

	void Setup(Pattern pattern)
	{
		for(int i = 0; i < pattern.patternSquare.Length; i++)
		{
			if(pattern.patternSquare[i])
			{
				GameObject pickup = Instantiate(pickupObj) as GameObject;

<<<<<<< HEAD
				Vector3 pickupPos = transform.position;
				pickupPos += new Vector3(i % pattern.width, -i/pattern.width);
				pickupPos.z = transform.position.z;
=======
				Vector3 pickupPos = transform.position + new Vector3(-1.0f, 1.0f) * ((float)pattern.size)/2.0f;
				pickupPos += new Vector3(i % pattern.size, -(int)i/pattern.size);
                pickupPos.x = (int)pickupPos.x;
                pickupPos.y = (int)pickupPos.y;
>>>>>>> master

				pickup.transform.position = pickupPos;
                pickup.transform.SetParent( gameObject.transform.parent);
			}
		}
	}

	void OnDrawGizmos()
	{
		if(drawGrid && !Application.isPlaying)
		{
			Pattern pattern = GetComponent<Pattern>();

			for(int i = 0; i < pattern.patternSquare.Length; i++)
			{
				if(pattern.patternSquare[i])
				{
<<<<<<< HEAD
					Vector3 pickupPos = transform.position;
					pickupPos += new Vector3(i % pattern.width, -i/pattern.width);
					pickupPos.z = transform.position.z;
=======
					Vector3 pickupPos = transform.position + new Vector3(-1.0f, 1.0f) * ((float)pattern.size)/2.0f;
					pickupPos += new Vector3(i % pattern.size, -(int)i/pattern.size);
                    pickupPos.x = (int)pickupPos.x;
                    pickupPos.y = (int)pickupPos.y;
>>>>>>> master

					Gizmos.color = drawColor;
					Gizmos.DrawCube(pickupPos, Vector3.one);
				}
			}
		}
	}
}
